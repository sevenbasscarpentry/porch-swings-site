
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Submissions — Seven Bass Carpentry</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
  <header class="header"><div class="container header-row"><a href="/" class="brand"><img src="/assets/logo5_stamp.png" alt="Seven Bass Carpentry"><span style="font-weight:700;letter-spacing:.02em">Seven Bass Carpentry</span></a><div class="muted">Internal — protected</div></div></header>
  <section class="section"><div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h1 class="h2">Quote submissions</h1>
      <div class="hstack"><button id="refresh" class="btn btn-ghost">Refresh</button><button id="csv" class="btn btn-primary">Download CSV</button></div>
    </div>
    <p id="status" class="muted" style="margin-top:.6rem">Loading…</p>
    <div style="overflow:auto;margin-top:1rem">
      <table class="table" id="tbl" style="display:none"><thead><tr><th>Date</th><th>Name</th><th>Email</th><th>Phone</th><th>City</th><th>Message</th></tr></thead><tbody></tbody></table>
    </div>
  </div></section>
  <script>
    async function load(){const s=document.getElementById('status'),t=document.getElementById('tbl');s.textContent='Loading…';t.style.display='none';try{const res=await fetch('/.netlify/functions/list-submissions');const text=await res.text();let data;try{data=JSON.parse(text);}catch(e){data={error:'Invalid JSON from function',raw:text};}if(!res.ok)throw new Error((data&&data.error)||('HTTP '+res.status));const rows=data,tb=t.querySelector('tbody');tb.innerHTML=rows.map(r=>`<tr><td>${new Date(r.created_at).toLocaleString()}</td><td>${r.name||''}</td><td>${r.email||''}</td><td>${r.phone||''}</td><td>${r.city||''}</td><td>${(r.message||'').replace(/</g,'&lt;')}</td></tr>`).join('');s.textContent=rows.length+' submission'+(rows.length===1?'':'s');t.style.display='table';window._rows=rows;}catch(e){s.textContent='Error: '+e.message+' (check env vars FORMS_ACCESS_TOKEN and FORMS_SITE_ID in Netlify)';}}
    function toCSV(rows){const cols=['created_at','name','email','phone','city','message'];const esc=s=>('"'+String(s).replace(/"/g,'""')+'"');return [cols.join(',')].concat((rows||[]).map(r=>cols.map(c=>esc(r[c]||'')).join(','))).join('\n');}
    document.getElementById('refresh').onclick=load;document.getElementById('csv').onclick=()=>{const csv=toCSV(window._rows||[]);const b=new Blob([csv],{type:'text/csv'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='submissions.csv';a.click();URL.revokeObjectURL(u);};load();
  </script>
</body></html>
