
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gallery Manager — Seven Bass Carpentry</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
  <header class="header"><div class="container header-row"><a href="/" class="brand"><img src="/assets/logo5_stamp.png" alt="Seven Bass Carpentry"><span style="font-weight:700;letter-spacing:.02em">Seven Bass Carpentry</span></a><div class="muted">Internal — Gallery Manager</div></div></header>
  <section class="section"><div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h1 class="h2">Edit gallery data</h1>
      <div class="hstack"><button class="btn btn-ghost" id="reload">Reload</button><button class="btn btn-primary" id="save">Save changes</button></div>
    </div>
    <p id="status" class="muted" style="margin-top:.6rem">Loading…</p>
    <div style="overflow:auto;margin-top:1rem">
      <table class="table" id="tbl" style="display:none;min-width:900px">
        <thead><tr><th>Thumb</th><th>File name</th><th>Caption</th><th>Type</th><th>Size</th><th>Hanging</th><th>Finish</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <p class="muted" style="margin-top:1rem">Images are pulled from <code>assets/gallery/</code>. Add or remove photos there in GitHub, then click Reload.</p>
  </div></section>
  <script>
    const API='/.netlify/functions/gallery-manifest';
    const tbl=document.getElementById('tbl'), body=tbl.querySelector('tbody'), statusEl=document.getElementById('status');
    document.getElementById('reload').onclick=load;
    document.getElementById('save').onclick=save;
    function row(item){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td><img class='thumb50' src='${item.url}' alt='${item.name}'></td>
        <td>${item.name}</td>
        <td contenteditable="true" data-k="caption">${item.caption||''}</td>
        <td contenteditable="true" data-k="type">${item.type||''}</td>
        <td contenteditable="true" data-k="size">${item.size||''}</td>
        <td contenteditable="true" data-k="hanging">${item.hanging||''}</td>
        <td contenteditable="true" data-k="finish">${item.finish||''}</td>`;
      tr.dataset.name=item.name;
      return tr;
    }
    async function load(){
      statusEl.textContent='Loading…'; tbl.style.display='none';
      try{
        const r=await fetch(API); if(!r.ok) throw new Error('Function error '+r.status);
        const data=await r.json(); window._sha=data.sha||null; body.innerHTML='';
        (data.items||[]).forEach(it=> body.appendChild(row(it)));
        tbl.style.display='table'; statusEl.textContent=(data.items||[]).length+' image(s)';
      }catch(e){ statusEl.textContent='Error: '+e.message; }
    }
    async function save(){
      const items = Array.from(body.querySelectorAll('tr')).map(tr=>{
        const get=k=> tr.querySelector(`[data-k="${k}"]`).innerText.trim();
        return { name: tr.dataset.name, caption:get('caption'), type:get('type'), size:get('size'), hanging:get('hanging'), finish:get('finish') };
      });
      statusEl.textContent='Saving…';
      try{
        const r=await fetch(API,{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({items, sha: window._sha})});
        if(!r.ok){ const t=await r.text(); throw new Error(t); }
        const d=await r.json(); window._sha=d.sha; statusEl.textContent='Saved! ('+new Date().toLocaleTimeString()+')';
      }catch(e){ statusEl.textContent='Error saving: '+e.message; }
    }
    load();
  </script>
</body>
</html>
